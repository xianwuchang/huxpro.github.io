---
layout:     post
title:      “一次网站「崩溃」的修复记录”
subtitle:   " \"网站维护\""
date:       2019-04-06 10:53:00
author:     "王永贤"
header-img: "img/post/post-bg-2019-04-06.jpg"
catalog: true
tags:
    - 网站奔溃
    - 网站运维
    - 问题解决
 
    

---

前两天朋友告诉我之前搭建的网站出现问题，打开网站，首页显示“Error Establishing A Database Connection”，连接数据库出现错误。因为太久没有接触这方面的信息，第一时间Google这个问题，另在在官方社区搜索问题。

![](https://ws3.sinaimg.cn/large/006y8mN6ly1g787a59xdcj30kt04u0st.jpg)



3年前对网站建设完全没有概念，其实现在也没有概念。当时公司组建，需要搭建网站，我当时想外包出去，沟通成本和后期维护成本很高，价格也不便宜，自己就在网上查了不少资料，最终决定自己尝试使用wordpress搭建网站，为了节省服务器费用，找了不少云服务器提供商，对比价格，阿里云一方面价格贵，另一方面备案需要花费时间太长。最终选择美国的digitalocean云服务器，最低版本5美元/月，内存500M，就是这么小。这个版本折合人民币也就35元/月，一年也不到400人民币。



依稀记得当时折腾过程，注册域名 - 寻找合适的服务器 - 找合适的Wordpress主题 - 搭建，其中花费大量时间在服务器搭建上，当时不认识有网站搭建经历的朋友，只能自己一点点在网上找教程、资料。由于选择的服务器提供商是美国公司，网站所有信息都是英文，这给自己工作增加了不少难度。找到一个教程很容易，但是在实践过程中遇到各种意外问题，这些问题往往花费大部分精力。



如何远程登录服务器？怎么远程传输文件到服务器？最开始连基本的计算机自带终端都不知道是什么，看到网上说输入代码控制服务器，我自己不知道在哪里输入，又开始去了解基本知识，学习服务器控制，前前后后花了一个月才把网站搭建起来。三年过去了，网站正常运行，没有遇到网站崩溃等问题，这次问题又是一次学习机会。



### 解决过程



谷歌搜索“Error Establishing A Database Connection”，发现有很多相关问题解答，其中最多的解决方案是在服务器wp-config.php文件中，增加代码define('WP_DEBUG', true); ，在digitalocean社区，也看到有用户遇到这个问题，最上面的回答也是这个处理方法。



这个解决方案出现在多个网页中，自然是多数人都遇到过，而且通过这个方法解决了问题，那我应该试一下。这下问题来了，wp-config.php文件在服务器上，我怎么连接服务器呢？时间太久，之前的操作很多都忘了，另外之前是在windows系统上搭建网站，现在换成mac，很多软件、系统都不一样。先要找到连接远程服务器的方法、软件。



接下来就是远程连接服务器，下载服务器文件，使用Yummy FTP登录，但登录一直失败，服务器地址没有问题，用户名没填写，后来才知道这是连接失败的原因。用户名要填写【root】。

![](https://ws3.sinaimg.cn/large/006y8mN6ly1g787a59xdcj30kt04u0st.jpg)



Yummy FTP登录失败，尝试使用FileZilla登录，3年前也是使用这个软件，下载打开后看起来就很熟悉，但连接还是失败。又尝试能否直接使用终端修改服务器文件，看到很多人说可以用Sublime Text远程控制服务器。




>sublime有个叫sftp的插件，可以通过它直接打开远程机器上的文件进行编辑，并在保存后直接同步到远程linux服务器上。用Package Control安装插件

>按下Ctrl+Shift+P调出命令面板

>输入install 调出 Install Package 选项并回车，然后输入ftp，下拉列表中会出现一些相关的插件，选中sftp进行安装就行了



按照这个方案在Sublime Text上操作，不知什么原因，最终还是失败。


![](https://ws4.sinaimg.cn/large/006y8mN6ly1g787bc0q1qj30hl0an74j.jpg)




这只能尝试在Mac自带终端试图连接服务器，在网上找到登录服务器的代码：ssh root@服务器地址,接下来就是找到之前设置的服务器密码，还好最终找到密码，成功登录。


![](https://ws3.sinaimg.cn/large/006y8mN6ly1g787g3ucwxj30fz08ljub.jpg)


既然登录服务器成功，那么就检查一下数据库是否运行正常，找到了检查数据库的代码 mysql -uroot -p,登录正常



执行service mysql start，服务器反馈： Job is already running: mysql，这就说明数据库目前正常运行

![](https://ws2.sinaimg.cn/large/006y8mN6ly1g787e2x3ljj30g401bt8l.jpg)





后来下载FTP软件，重新连接服务器，试了几次，突然想起当时登录时用户名填的是root，试了一次竟然连接成功了，看到服务器内的文件，好高兴。

![](https://ws1.sinaimg.cn/large/006y8mN6ly1g787es0ywfj30u00ej40f.jpg)



找到wp-config.php文件

![](https://ws3.sinaimg.cn/large/006y8mN6ly1g787f0hgnjj30gc04gglz.jpg)



打开wp-config.php文件，在最后一行增加了define('WP_DEBUG', true);


![](https://ws3.sinaimg.cn/large/006y8mN6ly1g787f6pnjfj30gt05owen.jpg)


上传wp-config.php文件到服务器后，登录网站，竟然还是失败，这下有些失望了，处理了这么久竟然还是不行，关键是检查数据库也是正常运行，这下不知道哪里出现了问题。



遇到这样的情况，最好的办法就是想放一下，把自己的的大脑先解放一段时间。有点好吃的不妨是个好的选择，就这样先放了几个小时，吃了不少东西。



既然问题变成这样，那还是在digitalocean社区寻找答案，最开始只看了前两个问题的答案，这次多看几个，把回答人数多一点的问题都看一看。

![](https://ws2.sinaimg.cn/large/006y8mN6ly1g787fd7795j30o40l2gnf.jpg)



好吧，看到有人说是因为服务器内存不够用了，之前使用的服务器配置是 500M Memory / 20 GB Disk / SFO1 - Ubuntu 14.04.4 x64 ，尝试调整为现在的1GB Memory / 20 GB Disk / SFO1 - Ubuntu 14.04.4 x64 。


![](https://ws3.sinaimg.cn/large/006y8mN6ly1g787fl6vg3j30c70cpwej.jpg)


升级服务器内存花了1个多小时，当时还挺着急，不知道能不能解决问题，今天早上起来检查，发现网站可以正常访问了，升级后还是最低版本，不过看价格还是一个月5美元，时间过去3年，云服务变得越来越常见，服务器价格也在降低。



后记



三年没有接触网站服务器，之前的很多操作现在已忘记，花费不少时间去寻找基本的操作方法、软件，这与当时网站搭建完成后没有及时复盘、总结有很大关系，这也是这次及时写下这篇文章的一个重要原因，记录这个过程，反思自己在解决问题过程中的操作、思考。另外很感谢当年程总给我机会，让我独自去搭建一个公司网站。



遇到自己不熟悉的问题，最高效的方法其实是找专业人士帮忙解决，咨询一个工程师，但因为涉及服务器细节，他并没有给我解答。我在提问时没有把背景说清楚，回答者自然很难给出可行的建议。当我们提问时，一定要提出具体、可操作的问题，不要提出宽泛、模糊的问题，需要把背景信息一并介绍清楚，方便解答者定位问题，能进一步解决问题。



相对成熟的付费产品，最直接的办法是联系客服，他们一般能够给出意见，但是在联系时，也要记得需要给出足够的背景信息。另外官方社区一般都会有常见问题的解答，我们遇到问题可优先在官方社区寻找答案，从这次我的经历来看，最终也是在官方社区找到了答案。



我最终是在官方社区找到解决方案，其实我一开始就在社区里搜索，但只看了前两个答案，在谷歌搜索时，搜到很多与官方社区第一个答案相同的回答，就直接按照这个方法去尝试了，没想到在这个过程中又遇到了各种问题，又得一一解决，关键是这些问题是三年前自己已经实践过的问题，由于之前没有记录，这次又花费太多时间。



复盘记录，另外可以建立模版的一定要建立模版，方便后期自己使用，或者是分享给其他人，减少不必要的失错成本。



升级服务器内存到1GB，但并没有增加服务器租金，三年过去，云服务、云计算变得越来常见，当初没有选择国内阿里云服务器的一个重要原因是价格，现在国内云服务器价格也便宜很多，去年双十一在腾讯云买了一个基础版服务器，3年一共不到500元。云服务器给创业公司、个人提供了便宜、方便的选择，这点变化很大。从另一个角度看，云服务器也是一种‘企业税’，只要你的公司一直使用，就需要向服务器提供商每年缴费，更换服务器成本很高，除非稳定性、价格相差太大，一般很少有企业会更换服务器提供商。



移动互联网的今天，PC端的网站的流量转移至app，现在火爆的小程序，如果你自己有想法想搭建一个小程序，市面上有很多小程序开发的提供商，也有像wordpress模式一样的公司，为你提供小程序模版，你可以零基本搭建自己的小程序。



个人网站搭建，现在还有一个更方便的选择，不用你租用服务器，把自己的个人博客搭建在github上,利用Github+Jekyll 很快你就能搭建起自己的个人博客。当然现在是微信占据了流量入口，可以注册一个公号，记录自己的复盘、思考，或者写下你想写的文字。




![](https://ws2.sinaimg.cn/large/006y8mN6ly1g776ekltnej30760760t7.jpg)
欢迎关注个人公众号